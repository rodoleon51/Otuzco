---
title: "Motivations Virgen de la Puerta"
author: "Rodolfo Le√≥n"
format: html
date: last-modified
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

```{r}
library(tidyverse)
library(readxl)
library(FactoMineR)
library(factoextra)
library(corrplot)
library(Factoshiny)
```

## Principal Components Analysis - PCA

```{r}
#Load the data
otuzco <- read_csv2("data/Motivaciones_Virgen_de_Otuzco_short_UTF8.csv")
```

```{r}
#Check the structure
#str(otuzco)
```

```{r}
#Create the data matrix
df_otuzco <- otuzco[, 2:38]
```

### Redundancy

```{r}
corrplot(cor(df_otuzco), tl.cex = .7)
```

```{r}
#Run the PCA
pca_result <- PCA(df_otuzco, ncp= 15, graph = TRUE)
```

### Explore the results

#### 1.Top 15 Eigenvalues

```{r}
pca_result$eig[1:15,]
```

#### 2. Top 15 Variables

```{r}
pca_result$var$coord[1:15, ]
```

#### 3. Top 15 individuals

##### Coordinates of individuals on the principal components
```{r}
pca_result$ind$coord[1:15,]
```

##### Cos2 : quality of representation of individuals on the principal components
```{r}
pca_result$ind$cos2[1:15,]
```

##### Contribution of individuals to the principal components
```{r}
pca_result$ind$contrib[1:15,]
```

### Scree plot (Contributions graph)

```{r}
fviz_eig(pca_result, ncp = 15, addlabels = TRUE)
```

### Visualize individuals and variables on the first two principal components

```{r}
fviz_pca_ind(pca_result, col.ind = "cos2", col.var = "contrib", repel = TRUE)
```

### Correlation circle

```{r}

fviz_pca_var(pca_result, col.var = "cos2", repel = TRUE)
```

```{r, echo=FALSE}

#res.shiny <- PCAshiny(otuzco)
```


```{r}
# Select the columns V2 to V24
selected_columns <- df_otuzco %>% select(1:25)
```

```{r}
data_coef = cor(df_otuzco)
```

```{r}
library(psych)
kmo_result <- KMO(data_coef)
kmo_value <- kmo_result$KMO
print(kmo_value)
```

```{r}
bartlett_result <- cortest.bartlett(data_coef, n = nrow(data_coef))
bartlett_p_value <- bartlett_result$p.value
print(bartlett_p_value)
```
